

# JPA 연관매핑 

## 참고자료 

1. 김영한님 인프런 강의
2. JPA 퀵스타트


 - 연관관계 매핑 개요
	 - 연관관계 매핑이 필요한 이유
		 - 객체지향
			 - 객체 지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다. - 조영호님
			 - ORM 자체보다는 객체지향스럽게 설계하는 것이 더 중요하고 어렵다. 
		 - 객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 객체간의 협력 관계를 설계할 수 없다. 
			 - 테이블은 외래키로 조인을해서 연관된 테이블을 찾으면 되지만, 객체는 객체 참조를 사용해서 연관 객체를 찾아야 한다. 
			 - 즉, 테이블 조인과 객체 참조는 패러다임의 차이가 있다.
	- 연관관계 매핑 시 고려사항
		- 다중성
			- ManyToOne
			- OneToMany
			- OneToOne
			- ManyToMany
		- 방향
			- 단방향
			- 양방향
		- 연관관계의 주인
		- 실무에서는, ManyToMany 는 사용하면 안됨
- 양방향 연관관계, 연관관계의 주인
	- 중요한 사실
		- 객체는 참조를 사용하고, 데이터베이스의 테이블은 외래키 조인을 사용한다는 큰 차이에 대해서 이해하는것이 중요
	- 양방향 매핑 사례
		- 단방향과의 비교
			- 단방향 : Member 에서 Team 을 참조할 수 있었지만, 팀에서 멤버를 참조할 수 없음
				- 데이터베이스에서는 조인 쿼리로 다 됨
			- 양방향
				- 팀에서도 멤버를 참조할 수 있음
	- 연관관계의 주인
		- 개요
			- 객체의 두 관계중 하나를 연관관계의 주인으로 지정해야 한다.
			- 연관관계의 주인만이 외래 키를 관리(등록, 수정)
			- 주인이 아닌 쪽은 읽기만 가능하다.
			- 주인은 mappedBy 속성을 사용하지 않는 쪽
			- 주인이 아니면 mappyedBy 속성으로 주인을 지정해야 함
		- 누구를 주인으로 해야하는가?
			- 외래키가 있는 곳을 주인으로 하면 된다.
			- 강의에서는, Member.team 이 연관관계의 주인
			- N 쪽이 연관관계의 주인
			- 비즈니스에서의 중요도랑 주인은 상관없다
- 양방향 매핑 시 가장 많이 하는 실수
	- 김영한님 강의
		- 단방향 매핑만으로도 이미 연관관계 매핑은 충분함
			- 즉, 처음 시스템은 단방향으로 마무리하는게 좋음
		- 양방향 매핑은 반대 방향으로 조회 기능이 추가된 것일뿐
		- 일단 단방향 매핑으로 설계를 하고, 그 이후에 정말 필요한 경우에 양방향을 추가한다. 
			- 테이블에는 영향을 주지 않음
		- 객체 입장에선느 양방향 참조는 단점이 많음
- 다대일
	- 개요
		- JPA 에서 가장 많이 사용
	- 샘플
		- 다대일 단방향
			- 외래키는 Member
			- 외래키가 있는 곳을 기준으로, 연관된 참조를 넣어서 매핑하면 됨
		- 다대일 양방향
			- 다대일에서 다에 해당하는 부분이 연관관계의 주인이 된다.
			- 설명 생략 - 인프랑 강의를 다시 보는게 좋을 듯
- 일대다
	- 개요
		- 사용을 추천하지 않음
	- 샘플
		- 일대일 단방향
			- 팀은 멤버를 알아야 하지만, 멤버에서는 팀을 알고 싶지 않은 경우
			- DB 입장에서는 무조건 다 쪽이 외래키가 들어가야 하는데, 객체와 테이블의 차이 때문에, 반대편 테이블의 외래키를 관리하는 특이한 구조
				- 즉, 사용을 추천하지 않음..
		- 일대일 양방향
			- 억지성이 있음.
- 일대일
	- 개요
		- 일대일 관계의 반대도 일대일
		- 주 테이블이나 대상 테이블 중에 외래키 선택 가능
		- 외래키에 데이터베이스 유니크 제약조건 추가
	- 주 테이블에 외래키
		- 주 객체가 대상 객체의 참조를 가짐
		- 주 테이블에 외래키를 두고, 대상 테이블을 찾음
		- 객체지향 개발자 선호
		- JPA 매핑 편리
		- 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능
		- 단점
			- 값이 없으면 외래키에 null 허용
			- DBA 입장에서는 치명적임
	- 대상 테이블에 외래키
		- 대상 테이블에 외래키 존재
		- 전통적인 데이터베이스 개발자 선호
		- 주 테이브로가 대상 테이블을 일대일에서 일대다 관계로 변경할 때 테이블 구조 유지 가능
		- 단점
			- 프록시 기능의 한계로, 지연 로딩으로 설정해도 항상 즉시 로딩 됨
- 다대다
	- 실무에서 사용하면 안됨..

 



> Written with [StackEdit](https://stackedit.io/).
